<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Water Logging Visualization (Leaflet)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="style_original.css"/>
    <style>
        /* Additional styles for report preview */
        .reports-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 20px auto;
            max-width: 1200px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .reports-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .reports-header h3 {
            color: #333;
            margin: 0;
            font-size: 24px;
        }

        .no-reports {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .reports-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #0877b6;
            transition: transform 0.2s ease;
        }

        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .report-id {
            font-weight: bold;
            color: #0877b6;
            font-size: 14px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-submitted {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .report-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
            align-items: flex-start;
        }

        .detail-label {
            font-weight: 500;
            color: #555;
            min-width: 100px;
            margin-right: 10px;
        }

        .detail-value {
            color: #333;
            flex: 1;
        }

        .severity-high {
            color: #d32f2f;
            font-weight: bold;
        }

        .severity-medium {
            color: #f57c00;
            font-weight: bold;
        }

        .severity-low {
            color: #388e3c;
            font-weight: bold;
        }

        .image-preview {
            margin-top: 15px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .image-preview img:hover {
            transform: scale(1.02);
        }

        .image-filename {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Modal for full-size image */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            top: 50%;
            transform: translateY(-50%);
        }

        .modal img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 25px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
        }

        .close:hover {
            opacity: 0.7;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 20px auto;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        /* ‚úÖ ADD THIS CSS TO YOUR <style> SECTION */

/* Main container for side-by-side layout */
.main-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin: 20px auto;
    max-width: 1400px;
    padding: 0 20px;
}

/* Map section styling */
.map-section {
    flex: 1;
    min-width: 400px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Form section styling - override existing form-container */
.form-container {
    flex: 0 0 400px !important;
    min-width: 350px !important;
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    border-radius: 12px !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
    padding: 20px !important;
    margin: 0 !important;
    max-width: none !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    height: fit-content;
}

/* Map container adjustments */
#leaflet-map {
    height: 500px !important;
    width: 100% !important;
    border-radius: 10px;
    border: 2px solid #ddd;
}

/* Map instructions */
.map-instructions {
    text-align: center;
    margin-top: 15px;
    color: #666;
    font-size: 14px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
}

/* Responsive design */
@media (max-width: 900px) {
    .main-container {
        flex-direction: column;
    }
    
    .form-container {
        flex: none !important;
        min-width: auto !important;
    }
    
    .map-section {
        min-width: auto;
    }
    
    #leaflet-map {
        height: 400px !important;
    }
}

    </style>
</head>
<body>
    <h1>Water Logging Reporting Tool</h1>
    <section class="about-section">
        <img src="Untitled-design-87.avif" 
             alt="Water logging image" class="about-image">
        <img src="water-log-of-solutions-2018-11-11.jpg" 
             alt="Water logging image" class="about-image">
        <img src="waterlogging.jpg" 
             alt="Water logging image" class="about-image">
        <div class="about-text">
            <h2>About Water Logging Visualization</h2>
            <p>Explore real-time water logging reports across India. Click on markers to view details, or use the form below to add new reports to the map.</p>
        </div>
    </section>

        <!-- Main Container with Map and Form Side by Side -->
    <div class="main-container">
        <!-- Map Section -->
        <div class="map-section">
            <h2>üìç Interactive Map</h2>
            <div id="leaflet-map"></div>
            <div class="map-instructions">
                <strong>üñ±Ô∏è Click anywhere on the map</strong> to select the location for your report.<br>
                The coordinates will automatically fill in the location field.
            </div>
        </div>

        <!-- Form Section -->
        <div class="form-container">
            <h2>üìã Report Water Logging Issue</h2>
            <form id="ReportingForm" method="post">
                <!-- Keep ALL your existing form fields exactly the same -->
                
                <label for="name">Your Name</label>
                <input type="text" id="name" name="name" placeholder="Enter your name" required>

                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="Enter your email" required>

                <label for="phone">Contact phone</label>
                <input type="tel" id="phone" name="phone" placeholder="Enter your Contact phone " pattern="[0-9+ ]{10,13}" required>

                <label for="location">Location</label>
                <input type="text" id="location" name="location" placeholder="Enter location" required>

                <label for="severity">Severity Level *</label>
                <select id="severity" name="severity" required>
                    <option value="">-- Select Severity --</option>
                    <option value="Low">üü¢ Low - Minor waterlogging</option>
                    <option value="Medium">üü° Medium - Moderate flooding</option>
                    <option value="High">üî¥ High - Severe flooding</option>
                </select>

                <label for="description">Description</label>
                <textarea id="description" name="description" placeholder="Describe the issue..." required></textarea>

                <label for="image">Attach Image</label>
                <input type="file" id="image" name="image" accept="image/*">

                <button type="submit">Submit Report</button>
            </form>
        </div>
    </div>


    <!-- Reports List Container -->
    <div id="reports-list" class="reports-section">
        <div class="reports-header">
            <h3>üìã Loading reports...</h3>
        </div>
    </div>
    <!-- Image Modal -->
    <div id="image-modal" class="modal" onclick="closeImageModal()">
        <div class="modal-content">
            <span class="close" onclick="closeImageModal()">&times;</span>
            <img id="modal-image" src="" alt="Full size image">
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="main_minimal_fix.js"></script>
    <script>
const scriptURL = "https://script.google.com/macros/s/AKfycbymhAgoBJ-P3fY7Ok-aOSsBvbbu2QhJct7er3ouAxi0YK-m0-sVznlW33S8ozpaaI42/exec"; // we have added url of google app script
let submittedReports = [];
let reportIdCounter = 1;


document.getElementById("ReportingForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  let formData = new FormData(e.target);
  let file = formData.get("image");

  // Convert image to Base64

  let reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onloadend = async function () {
    let base64Data = reader.result.split(",")[1]; // sirf base64 part
    
    let payload = {
     	name: formData.get("name"),  // for name Matches <input name="name">
	email: formData.get("email"), // for email Matches <input name="name">
	phone: formData.get("phone"),// for phone Matches <input name="phone">
     	location: formData.get("location"), // for location Matches <input name="location"> 
	
    	description: formData.get("description"),  // for description Matches <input name="description">

 
      image: {
        name: file.name, 
        type: file.type,
        data: base64Data
      }
    };

    let response = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify(payload),
    });

    let text = await response.text();
    alert("Server response: " + text);
  };
});
// Function to render reports list
        function renderReportsList() {
            const reportsContainer = document.getElementById('reports-list');

            if (submittedReports.length === 0) {
                reportsContainer.innerHTML = `
                    <div class="reports-header">
                        <h3>üìã Submitted Reports</h3>
                        <p class="no-reports">No reports submitted yet. Submit a report above to see it here!</p>
                    </div>
                `;
                return;
            }

            reportsContainer.innerHTML = `
                <div class="reports-header">
                    <h3>üìã Submitted Reports (${submittedReports.length})</h3>
                </div>
                <div class="reports-container">
                    ${submittedReports.map(report => `
                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-id">#WL${String(report.id).padStart(4, '0')}</div>
                                <div class="status-badge status-${report.status.toLowerCase()}">${report.status}</div>
                            </div>
                            <div class="report-details">
                                <div class="detail-row">
                                    <span class="detail-label">üë§ Name:</span>
                                    <span class="detail-value">${report.name}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üìß Email:</span>
                                    <span class="detail-value">${report.email}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üìû Phone:</span>
                                    <span class="detail-value">${report.phone}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üìç Location:</span>
                                    <span class="detail-value">${report.location}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">‚ö†Ô∏è Severity:</span>
                                    <span class="detail-value severity-${report.severity.toLowerCase()}">${report.severity}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üìù Description:</span>
                                    <span class="detail-value">${report.description}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üïí Submitted:</span>
                                    <span class="detail-value">${report.timestamp}</span>
                                </div>
                            </div>
                            ${report.imageUrl ? `
                                <div class="image-preview">
                                    <img src="${report.imageUrl}" alt="Report image" onclick="openImageModal('${report.imageUrl}')">
                                    <div class="image-filename">${report.imageName}</div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }
// Function to add marker to map
        function addReportMarker(report) {
            if (report.location && report.location.includes(',')) {
                const [lat, lng] = report.location.split(',').map(Number);

                const pinIcon = L.icon({
                    iconUrl: report.severity === "High" 
                        ? "https://maps.google.com/mapfiles/ms/icons/red-dot.png"
                        : report.severity === "Medium"
                        ? "https://maps.google.com/mapfiles/ms/icons/orange-dot.png" 
                        : "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
                    iconSize: [32, 32],
                    iconAnchor: [16, 32],
                    popupAnchor: [0, -28]
                });

                L.marker([lat, lng], {icon: pinIcon})
                    .addTo(map)
                    .bindPopup(`
                        <b>üö® ${report.severity} Severity</b><br>
                        <b>üë§ Reporter:</b> ${report.name}<br>
                        <b>üìû Phone:</b> ${report.phone}<br>
                        <b>üìù Description:</b> ${report.description}<br>
                        <b>üïí Submitted:</b> ${report.timestamp}
                    `);
            }
        }
 // Image modal functions
        function openImageModal(imageSrc) {
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-image');
            modal.style.display = 'block';
            modalImg.src = imageSrc;
        }

        function closeImageModal() {
            document.getElementById('image-modal').style.display = 'none';
        }
        // Initial render
        renderReportsList();

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('image-modal');
            if (event.target === modal) {
                closeImageModal();
            }
        }

</script>

</body>
</html>